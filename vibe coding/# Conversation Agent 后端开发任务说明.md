# Conversation Agent åç«¯å¼€å‘ä»»åŠ¡è¯´æ˜

## ğŸ§  é¡¹ç›®ç›®æ ‡

ä½¿ç”¨ `FastAPI + LangGraph + LangChain` æŠ€æœ¯æ ˆï¼Œæ„å»ºä¸€ä¸ªæ”¯æŒå¤šæ¨¡å‹ã€å¤šå·¥å…·è°ƒç”¨ã€æµå¼è¾“å‡ºã€ä¼šè¯è®°å¿†ç®¡ç†çš„ **Conversation Agent åç«¯æœåŠ¡**ï¼Œå…·å¤‡è‰¯å¥½çš„ä»£ç ç»“æ„ã€å¯æ‰©å±•æ€§ä¸é…ç½®çµæ´»æ€§ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¦æ±‚

- **Web æ¡†æ¶**ï¼šFastAPIï¼ˆè¿è¡Œåœ¨ç«¯å£ `8000`ï¼‰
- **Agent æ¡†æ¶**ï¼šLangGraph + LangChain
- **è™šæ‹Ÿç¯å¢ƒ**ï¼šä½¿ç”¨ `venv` ç®¡ç†ä¾èµ–
- **æ•°æ®åº“**ï¼šSQLiteï¼ˆå¯æ‰©å±•ä¸ºå…¶ä»–æ•°æ®åº“ï¼‰
- **é…ç½®æ–‡ä»¶**ï¼šæ”¯æŒ YAML / JSON æ ¼å¼

---

## ğŸ“¦ åŠŸèƒ½æ¨¡å—éœ€æ±‚

### 1. Logging æœºåˆ¶

- ä½¿ç”¨æ ‡å‡† logging æ¡†æ¶ï¼ˆå¦‚ `loguru` æˆ– `logging` æ¨¡å—ï¼‰
- ç¦æ­¢ä½¿ç”¨ `print` è¾“å‡º
---

### 2. æµå¼è¾“å‡ºæ”¯æŒ

- æ”¯æŒå­—ç¬¦é€æ­¥è¾“å‡ºï¼ˆå¯é€šè¿‡ `asyncio.sleep` æ¨¡æ‹Ÿï¼‰
- æ”¯æŒä¸€æ¬¡æ€§è¿”å›å®Œæ•´å“åº”
- è¾“å‡ºæ–¹å¼æ”¯æŒï¼š
  - Server-Sent Eventsï¼ˆSSEï¼‰
  - LangChain çš„ `streamable event` åè®®
- ä¸»æ¥å£è·¯å¾„ï¼š`/chat/stream`

---

### 3. LLM æ¨¡å‹é…ç½®ä¸åŠ è½½

- æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæ¨¡å‹ï¼š
  - ç¤ºä¾‹ï¼š`azure/gpt-4.1`ã€`openai/gpt-4o`ã€`google/gemini-pro`
- æ”¯æŒ Providerï¼š
  - Azure OpenAI
  - OpenAI
  - Google
- é…ç½®æ–‡ä»¶è·¯å¾„ä½œä¸º Agent åˆå§‹åŒ–å‚æ•°ä¼ å…¥
- æ¨¡å‹åŠ è½½é€»è¾‘åº”æŠ½è±¡ä¸ºç»Ÿä¸€æ¥å£ï¼Œä¾¿äºæ‰©å±•

---

### 4. Embedding æ¨¡å‹é…ç½®

- åŒæ ·æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šï¼š
  - ç¤ºä¾‹ï¼š`azure/text-embedding-ada-002`
- æ”¯æŒ Providerï¼š
  - Azure OpenAI
  - OpenAI
  - Google
- ä¸ LLM æ¨¡å‹é…ç½®ç»“æ„ä¿æŒä¸€è‡´

---

### 5. Tool è°ƒç”¨æœºåˆ¶

- åˆ›å»º4ä¸ªç®€å•åœ°math toolç”¨äºæµ‹è¯•ï¼š
  - `add`: ä¸¤æ•°ç›¸åŠ 
  - `subtract`: ä¸¤æ•°ç›¸å‡
  - `multiply`: ä¸¤æ•°ç›¸ä¹˜
  - `divide`: ä¸¤æ•°ç›¸é™¤
- Agent æ ¹æ®ç”¨æˆ·è¾“å…¥åˆ¤æ–­æ˜¯å¦åŒ¹é… Tool Schema
- è‹¥åŒ¹é…ï¼š
  - è°ƒç”¨å¯¹åº” Tool
  - å°† Tool çš„è°ƒç”¨ç»“æœä¸ Schema ä¸€å¹¶ä½œä¸ºè¾“å…¥ä¼ ç»™ LLM
  - Tool çš„è°ƒç”¨è¿‡ç¨‹ä¸ç»“æœéœ€é€šè¿‡ stream è¿”å›ç»™ç”¨æˆ·
- è‹¥æ— åŒ¹é… Toolï¼Œç›´æ¥å°†ç”¨æˆ·è¾“å…¥äº¤ç»™ LLM å¤„ç†

---

### 6. ChatHistory ä¸ Memory ç®¡ç†

- æ€»å­—ç¬¦æ•° â‰¤ 3200ï¼š
  - æ­£å¸¸è¿½åŠ ç”¨æˆ·ã€AIã€Tool ç­‰æ¶ˆæ¯
- æ€»å­—ç¬¦æ•° > 3200ï¼š
  - ä½¿ç”¨ LLM å¯¹å†å²è¿›è¡Œæ‘˜è¦ï¼ˆsummarizeï¼‰
  - æ‘˜è¦ä¿¡æ¯ä¸å­˜å…¥æ•°æ®åº“ï¼Œä»…ç”¨äºå†…å­˜ä¸­å‹ç¼©ä¸Šä¸‹æ–‡
- æ”¯æŒå¤šç±»å‹æ¶ˆæ¯ï¼ˆå¯æ‰©å±•ï¼‰

---

### 7. ä¼šè¯æŒä¹…åŒ–ä¸æ•°æ®åº“è®¾è®¡

- ä½¿ç”¨ SQLite å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œè·¯å¾„ä¸ºï¼š
  ```
  stream-yomi-chatbot/database/chat_history.db
  ```
- æ•°æ®åº“è®¾è®¡è¦æ±‚ï¼š
- ä¸ Agent è§£è€¦
- æä¾›æŠ½è±¡æ¥å£ï¼Œä¾¿äºæœªæ¥æ‰©å±•å…¶ä»–æ•°æ®åº“
- æ”¯æŒæŒ‰ session_id åŠ è½½å†å²è®°å½•
- ä¸å­˜å‚¨ summarize åçš„å†…å®¹ï¼Œä»…å­˜åŸå§‹æ¶ˆæ¯

---

## ğŸ“ é¡¹ç›®ç»“æ„å»ºè®®ï¼ˆç¤ºæ„ï¼‰
```
stream-yomi-chatbot/ â”œâ”€â”€ main.py â”œâ”€â”€ agent/ â”‚ â”œâ”€â”€ builder.py â”‚ â”œâ”€â”€ memory.py â”‚ â”œâ”€â”€ tools/ â”‚ â”œâ”€â”€ models/ â”‚ â””â”€â”€ config/ â”‚ â”œâ”€â”€ llm_config.yaml â”‚ â””â”€â”€ embedding_config.yaml â”œâ”€â”€ database/ â”‚ â”œâ”€â”€ chat_history.db â”‚ â””â”€â”€ interface.py â”œâ”€â”€ api/ â”‚ â””â”€â”€ routes.py â”œâ”€â”€ utils/ â”‚ â””â”€â”€ logger.py â””â”€â”€ README.md
```

---

## ğŸ“„ é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆYAMLï¼‰

```yaml
llm:
  provider: azure
  model: gpt-4.1
  api_key: YOUR_KEY
  endpoint: https://your-endpoint.openai.azure.com/

embedding:
  provider: openai
  model: text-embedding-ada-002
  api_key: YOUR_KEY
```

## å¼€å‘è§„èŒƒè¡¥å……
æ‰€æœ‰æ¨¡å—åº”å…·å¤‡è‰¯å¥½çš„æŠ½è±¡æ¥å£
ä»£ç åº”ç®€æ´ç›´è§‚ï¼Œä¾¿äºç»´æŠ¤ä¸æ‰©å±•
æä¾›å®Œæ•´çš„è¯´æ˜æ–‡æ¡£ï¼ˆREADMEï¼‰